%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%FINAL VERSION:
%look for numbered but unlabelled equations
%\usepackage{refcheck}%compile twice in order to see the effects

%To avoid warnings
%e.g., Font shape `OT1/cmr/bx/n' in size <10.5> not available(Font) size <10.95> substituted
%https://tex.stackexchange.com/questions/58087/how-to-remove-the-warnings-font-shape-ot1-cmss-m-n-in-size-4-not-available
\usepackage{anyfontsize}

%change the font sizes
%http://mirror.hmc.edu/ctan/macros/latex/base/classes.pdf, from page 7
\makeatletter
\renewcommand\normalsize{\@setfontsize\normalsize{10.5}{12.5}} %original: 10, 12
\renewcommand\small{\@setfontsize\small{9.5}{11.5}} %original: 9, 11
\renewcommand\footnotesize{\@setfontsize\footnotesize{8.5}{10}} %original: 8, 9.5
\renewcommand\scriptsize{\@setfontsize\scriptsize{7.5}{8.5}} %original: 7, 8
%I define a new fontsize the same as I used inside figures.
\newcommand\mysubcaptionfont{\@setfontsize\mysubcaptionfont\@xpt\@xiipt}
%\newcommand\mysubcaptionfont{\@setfontsize\mysubcaptionfont\@xivpt\@xivpt}
\makeatother
\small
\normalsize
\footnotesize
\scriptsize
\mysubcaptionfont

\DeclareCaptionFont{mysubcaptionfont}{\mysubcaptionfont}
%\usepackage{caption} %was defined in wup.cls
\captionsetup{
    justification=justified %Distribute text evenly between margins
}
\captionsetup[sub]{
	justification=centering,
	font=mysubcaptionfont, %I used 10pt when I drew figures
	labelformat=empty,
}




\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

% running footnotes in whole document 
\usepackage{chngcntr} 
\counterwithout{footnote}{chapter} 
% style of footnotes left-justified in justification 
\usepackage[bottom,hang,marginal]{footmisc} 
\setlength{\footnotemargin}{1.3em}
%extra penalty for breaking after first line of a paragraph: 
\clubpenalty = 10000 
%extra penalty for breaking before last line of a paragraph:
\widowpenalty = 10000
%extra penalty for breaking before last line before a display math:
\displaywidowpenalty = 10000

\graphicspath{{images/}}
\usepackage{wrapfig}
%\usepackage[ngerman]{babel}
\usepackage[english]{babel} % to write documents in languages


\usepackage{lipsum}  % Loading lipsum to write blind text


\usepackage{amsmath}  %align equations; text inside math

\usepackage{amsthm} %for using open problem
\theoremstyle{definition}
\newtheorem{open}{Open Problem}

%\usepackage{array}%for making new column types; included
\usepackage{bm} %make a variable bold in math mode 
\usepackage{booktabs} %for using \toprule, \midrule, and 
%\bottomrule in a table
\usepackage{dcolumn} %for \newcolumntype{d}[1]{D{'}{.}{#1}}
%https://stackoverflow.com/questions/4968557/latex-very-compact-itemize/4974583#4974583
\usepackage{enumitem} %for compact itemize
\usepackage{float} %option "H" for placing a figure
\usepackage[bottom]{footmisc}% places footnotes at page bottom
\usepackage{gensymb}  % for degree sign
% when including figure files
\usepackage[defaultlines=4,all]{nowidow}%forbid widow or orphan

\usepackage{ragged2e}
\justifying

\usepackage{hyperref}
\hypersetup{linktocpage=true}
\hypersetup{colorlinks=true}
\hypersetup{hidelinks}
%\hypersetup{pdftitle = {An Optimization-Based Approach for 
%		Continuous Map Generalization}}
\hypersetup{pdfauthor = {Dongliang Peng}}
\hypersetup{pdfsubject = {Dissertation}}
\hypersetup{pdfkeywords = {Land-cover area, Administrative boundary, 
Building, Morphing, Data structure, Zooming}}
\hypersetup{pdfdisplaydoctitle = true}
\newcommand{\dlpLinkColor}{black}
\hypersetup{
	linktoc=all,
	colorlinks,
	citecolor=\dlpLinkColor,
	filecolor=\dlpLinkColor,
	linkcolor=black,
	urlcolor=\dlpLinkColor
}

%prevent links in bibliography overflowing into the margin
%https://tex.stackexchange.com/questions/115690/urls-in-bibliography-latex-not-breaking-line-as-expected
%\hypersetup{breaklinks=true}
\usepackage{url}
\urlstyle{same}
%\Urlmuskip=0mu plus 1mu\relax

%make the font of math charter; for \mathbb
%cal=cmcal: make a difference between $\mathcal{H}$ and $\mathscr{H}$
%see https://tex.stackexchange.com/questions/454415/how-to-use-mathcal-fonts-with-charter-font-from-mathdesign
\usepackage[charter,cal=cmcal]{mathdesign}


\usepackage{multicol}        % used for the two-column index
%\pgfplotsset{compat=1.3} %make the label tight in axis picture

%\usepackage{sansmathfonts}%make the font in math model sansserif
\usepackage{tabularx} %to define the style of a column in a table


%To encourage LaTeX not to move your figure, 
%you may need to loosen its demands.
%https://texfaq.org/FAQ-floats
\renewcommand{\textfraction}{0.01}
\renewcommand{\topfraction}{0.99}
\renewcommand{\bottomfraction}{0.99}
\renewcommand{\dbltopfraction}{0.99} % fit big float above 
%\renewcommand{\topfraction}{.85}
%\renewcommand{\bottomfraction}{.7}
%\renewcommand{\textfraction}{.15}
\renewcommand{\floatpagefraction}{.66}
%\renewcommand{\dbltopfraction}{.66}
\renewcommand{\dblfloatpagefraction}{.66}
\setcounter{topnumber}{9}
\setcounter{bottomnumber}{9}
\setcounter{totalnumber}{20}
\setcounter{dbltopnumber}{9}


\usepackage[disable]{todonotes} %need package tikz
%\usepackage[textwidth=2cm]{todonotes}
\makeatletter %make package todonotes compatible with wup.cls 
\providecommand\@dotsep{5}
\renewcommand{\listoftodos}[1][\@todonotes@todolistname]{%
	\@starttoc{tdo}{#1}}
\makeatother

\usepackage{xspace} %we use \xspace for \Astar

%if a figure is on an empty last page,
%the figure will be placed at the top instead in the middle of 
%the page
\makeatletter
\setlength{\@fptop}{0pt}
\setlength{\@fpsep}{8pt} %8pt between two figures at last page
\makeatother



%style: Loads bibliography style .bbx and citation style cbx
%bibstyle: Loads bibliography style .bbx
\usepackage[
backend=biber,
%backend=bibtex,
%style=trad-alpha,
style=alphabetic, %style for my thesis
sorting=nyt, %sort by name, year, title
%bibstyle=authoryear, %no indices before names; year after names
%bibstyle=numeric, %number the references
hyperref=true,%transform citations and back references into 
%clickable hyperlinks
backref=true, %to print back references in the bibliography
backrefstyle=three, %Compress three or more consecutive pages 
%to a range
%,
%citestyle=authoryear,
maxbibnames=9, %the author names appearing in bibliography
maxcitenames=2, %the author names appearing in text
giveninits=true,
%terseinits=true,%remove periods after initials of first names
%doi=false,
%isbn=false,url=false,
eprint=false,
%dashed=false,
useprefix=false,%sort bibliography not using prefix like "van"
natbib=true]{biblatex}
\addbibresource{general/Reference/BibReference.bib}

\DeclareNameAlias{author}{family-given}%lastname before firstname
%\renewcommand*{\revsdnamepunct}{} %remove commas between last 
%and first names





%if a reference has doi, then we print only doi in bibliography;
%otherwise, we print only url
%we don't use eprint
%we must deactivate eprint by using "eprint=false"
\renewbibmacro*{doi+eprint+url}{% 
	\iftoggle{bbx:url} 
	{\iffieldundef{doi}{\usebibmacro{url+urldate}}{}} 
	{}% 
	%	\newunit\newblock 
	%	\iftoggle{bbx:eprint} 
	%	{\usebibmacro{eprint}} 
	%	{}% 
	\newunit\newblock 
	\iftoggle{bbx:doi} 
	{\printfield{doi}} 
	{}}	



%remove the information we don't want to present
\AtEveryBibitem{% Clean up the bibtex rather than editing it
	\clearlist{address}
	\clearfield{date}
%	\clearfield{eprint}
	\clearfield{isbn}
	\clearfield{issn}
	\clearlist{location}
	\clearfield{month}
	\clearlist{language}
	%	\clearfield{series}
	
	\ifentrytype{book}{}{% Remove publisher and editor except for books
		\clearlist{publisher}
		%		\clearname{editor}
	}
}

%%display pagetotal of proceedings
%\DeclareFieldFormat[inproceedings]{pagetotal}{\mkpagetotal[bookpagination]{#1}}
%\renewbibmacro*{chapter+pages}{%
%	\printfield{note}%
%	\setunit{\bibpagespunct}%
%	\printfield{pages}%
%	\setunit{\bibpagespunct}%
%	\printfield{pagetotal}%
%	\newunit}

%\ppspace defaults to \addnbspace, a non-breaking space
%we redefine \ppspace to a normal space
%https://tex.stackexchange.com/questions/167065/what-is-the-reason-to-put-a-tilde-between-p-page-and-the-number
\renewcommand{\ppspace}{ }
%change "cited on page(s)" to "see page(s)" in Bibliography
\DefineBibliographyStrings{english}{
  backrefpage  = {see p\adddot},
  backrefpages = {see pp\adddot},
  %https://tex.stackexchange.com/questions/277272/biblatex-how-to-remove-the-period-after-p-pp-in-bibliography-only
%  page  = {p\adddot},
%  pages = {pp\adddot},
}

%change parentheses of backrefs to brackets in Bibliography
\renewbibmacro*{pageref}{%
  \iflistundef{pageref}
    {}
    {\printtext[brackets]{%\printtext[parens]
       \ifnumgreater{\value{pageref}}{1}
         {\bibstring{backrefpages}\ppspace}
         {\bibstring{backrefpage}\ppspace}%
       \printlist[pageref][-\value{listtotal}]{pageref}}}}





%\iffalse
%For the references, the following commands make the titles 
%lowercase (sentence case),
%while keep book/journal/conference etc. names unchanged 
\DeclareFieldFormat{sentencecase}{\MakeSentenceCase{#1}}
\renewbibmacro*{title}{%
	\ifthenelse{\iffieldundef{title}\AND\iffieldundef{subtitle}}
	{}
	{\ifthenelse{\ifentrytype{article}\OR\ifentrytype{inbook}%
			\OR\ifentrytype{incollection}\OR\ifentrytype{inproceedings}%
			\OR\ifentrytype{inreference}}
		{\printtext[title]{%
				\printfield[sentencecase]{title}%
				\setunit{\subtitlepunct}%
				\printfield[sentencecase]{subtitle}}}%
		{\printtext[title]{%
				\printfield[titlecase]{title}%
				\setunit{\subtitlepunct}%
				\printfield[titlecase]{subtitle}}}%
		\newunit}%
	\printfield{titleaddon}}

%Remove the quotation marks for the titles in the reference
\DeclareFieldFormat[article,inbook,incollection,inproceedings,
patent,thesis,unpublished]{citetitle}{#1}
\DeclareFieldFormat[article,inbook,incollection,inproceedings,
patent,thesis,unpublished]{title}{#1}



%make the prefix of a name capital, e.g., van Dijk -> Van Dijk
%https://tex.stackexchange.com/questions/226893/biblatex-handling-of-dutch-van-prefix
\renewbibmacro*{begentry}{\midsentence} %lower-case in the bibliography
\makeatletter
\AtBeginDocument{\toggletrue{blx@useprefix}}
\makeatother

%change \textsc{DOI} to DOI, and so on, in bibliography
%https://tex.stackexchange.com/questions/58636/how-to-change-the-font-for-biblatex-acronyms
\renewcommand*{\mkbibacro}[1]{#1}

%General


\newcommand{\revise}[2]{#2}
\newcommand{\mypar}[1]{\bigskip\noindent\textbf{#1.}~}
%\newcommand{\mysmalltitle}[1]{{\bigskip\noindent\sffamily\bfseries #1}}

%define that formats for subsubsections
\titleformat{\subsubsection}
{\normalfont\sffamily\bfseries}{\thesubsubsection}{1em}{}


\newcommand{\AreaAggTitle}
%{Finding Optimal Sequences for Area 
%Aggregation---\Astar vs.\ Integer Linear Programming}
{Finding Optimal Sequences
 \\ for Area Aggregation---
 \\ \Astar vs.\ Integer Linear Programming}
\newcommand{\AreaAggToCTitle}
{Finding Optimal Sequences for Area 
Aggregation---\texorpdfstring{\Astar vs.\ Integer Linear Programming}
                             {A* vs.\ Integer Linear Programming}}
\newcommand{\AreaAggChapterMark}
{Finding Optimal Sequences for Area Aggregation}

\newcommand{\AdminBoundTitle}
%{Continuously Generalizing Administrative Boundaries Based on Compatible Triangulations}
{Continuously Generalizing\\ 
 Administrative Boundaries\\
 Based on Compatible Triangulations}
\newcommand{\AdminBoundToCTitle}
{Continuously Generalizing Administrative Boundaries
 Based on Compatible Triangulations}     
\newcommand{\AdminBoundChapterMark}
{Continuously Generalizing Administrative Boundaries Based on CTs}

\newcommand{\BldgGrowTitle}
%{Continuously Generalizing Buildings to Built-up Areas
% by Aggregating and Growing}
{Continuously Generalizing\\ 
   	Buildings to Built-up Areas\\
   	by Aggregating and Growing}
\newcommand{\BldgGrowToCTitle}
{Continuously Generalizing Buildings to Built-up Areas
 by Aggregating and Growing}
\newcommand{\BldgGrowChapterMark}
{Continuously Generalizing Buildings to Built-up Areas}

\newcommand{\MorphTitle}
%{Morphing Polylines Based on Least-Squares Adjustment}
{Morphing Polylines\\
 Based on Least-Squares Adjustment}
\newcommand{\MorphToCTitle}
{Morphing Polylines Based on Least-Squares Adjustment}

\newcommand{\DataStrTitle}
%{Choosing the Right Data Structures for Solving Spatial Problems}
{Choosing the Right Data Structures\\
 for Solving Spatial Problems}
\newcommand{\DataStrToCTitle}
{Choosing the Right Data Structures for Solving Spatial Problems}

%Preface: Adminstrative Boundaries
\newcommand{\ml}{\ensuremath{M_+}\xspace}
\newcommand{\ms}{\ensuremath{M_-}\xspace}
%\newcommand*{\mine}[1]{{\color{red}#1}}
\newcommand*{\mine}[1]{{#1}}

%see https://tex.stackexchange.com/questions/7032/good-way-to-make-textcircled-numbers
\newcommand{\circled}[1]{\textcircled{#1}}


% math-mode version of "l" column type
\newcolumntype{L}{>{$}l<{$}}
% math-mode version of "r" column type
\newcolumntype{R}{>{$}r<{$}}
% math-mode version of "c" column type
\newcolumntype{C}{>{$}c<{$}}
%align numbers by decimal points in table; 
%need package {dcolumn} and {array}
%see http://www.ctex.org/documents/packages/table/dcolumn.pdf 
\newcolumntype{d}[1]{D{'}{.}{#1}}
\newcolumntype{s}[1]{D{'}{~}{#1}}

%x:l, y:c, z:r, with specified width
%place text in a cell at top (b), middle (m), or bottom (p)
\newcolumntype{x}[1]
{>{\raggedright\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{y}[1]
{>{\centering\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{z}[1]
{>{\raggedleft\arraybackslash\hspace{0pt}}m{#1}}

%%math-mode version of "x,y,z" column type
%\newcolumntype{X}[1]
%{>{\raggedright\arraybackslash\hspace{0pt}}m{$#1$}}
%\newcolumntype{Y}[1]
%{>{\centering\arraybackslash\hspace{0pt}}m{$#1$}}
%\newcolumntype{Z}[1]
%{>{\raggedleft\arraybackslash\hspace{0pt}}m{$#1$}}

\newcommand{\dtrm}[2][]{d_{\mathrm{#2}, 
t\ifthenelse{\equal{#1}{}}{}{_#1}}}

%%Area Aggregation
%%**************************************************************
\newcommand{\Astar}{A$^{\!\star}$\xspace}
\newcommand{\AstarTwo}{A$^{\!\star}_{\,200{,}000}$\xspace}
\newcommand{\AstarFour}{A$^{\!\star}_{\,400{,}000}$\xspace}
\newcommand{\ILPOne}{ILP$_{100\,\mathrm{s}}$\xspace}
\newcommand{\ILPTwo}{ILP$_{200\,\mathrm{s}}$\xspace}

\newcommand{\tstar}{\ensuremath{t\xspace}}
\newcommand{\Pistar}{\ensuremath{\Pi}} % 
%\newcommand{\Comp}[1]{c_#1} % 
\newcommand{\comp}[1]{[#1]} % 
\newcommand{\edgenum}[1]{\|#1\|}
\newcommand{\area}[1]{\overline{#1}}
%{\Pi_{\mathrm{start}}(\tstar)}
\newcommand{\Pstart}{\ensuremath{P_\mathrm{start}}\xspace}
\newcommand{\Pgoal}{\ensuremath{P_\mathrm{goal}}\xspace}
\newcommand{\Pnode}{\ensuremath{P_{t,i}}\xspace}
\newcommand{\Psnode}{\ensuremath{P_{s,i}}\xspace}
\newcommand{\Tgoal}{\ensuremath{T_\mathrm{goal}}\xspace}


\newcommand{\e}[1]{\times 10^{#1}}
\newcommand{\fig}{Figure~}
\newcommand{\eq}{Equation~}
\newcommand{\fo}{Formula~}
\newcommand{\sect}{Section~}
\newcommand{\tab}{Table~}
\newcommand{\chap}{Chapter~}
\newcommand{\figs}{Figures~}
\newcommand{\eqs}{Equations~}
\newcommand{\fos}{Formulas~}
\newcommand{\sects}{Sections~}
\newcommand{\tabs}{Tables~}
\newcommand{\chaps}{Chapters~}
\newcommand{\myquad}[1][1]{\hspace*{#1em}\ignorespaces}
\newcommand{\eqquadVariable}{\myquad[6]}
\newcommand{\eqquadCost}{\myquad[2]}
\newcommand{\eqquadConstraintsX}{\myquad[4]}
\newcommand{\eqquadConstraintsYZ}{\myquad[3]}
\newcommand{\eqquadConstraintsC}{\myquad[3]}
\newcommand{\eqquadConstraints}{\myquad[3]}
\newcommand{\eqquadConstraintW}{\myquad[3]}
\newcommand{\inquad}{\qquad}
\newcommand{\inquadC}{\myquad[1]}

%because of \begin{array}
%\newcommand{\embshift}{\hspace{0.5pt}}%for tsas 
%\newcommand{\embshift}{\hspace{-3pt}}%for my thesis(10pt)
\newcommand{\embshift}{\hspace{-2.7pt}}%for my thesis(10.5pt)

%M or N are default tags. 
%The boxes using the same tag will have the same length. 
%The length is the maximum length of all the equations 
%in the boxes that use the same tag; see also 
%https://tex.stackexchange.com/questions/381502/how-to-align-text-in-multiple-separate-align-environments
\usepackage{eqparbox}
\newcommand{\embl}[2][M]
{\eqmakebox[#1][l]{$#2$}}
\newcommand{\embr}[2][N]
{\eqmakebox[#1][r]{$#2$}}
\newcommand{\embld}[2][M]
{\eqmakebox[#1][l]{$\displaystyle#2$}}
\newcommand{\embrd}[2][N]
{\eqmakebox[#1][r]{$\displaystyle#2$}}

%avoid warning
%https://tex.stackexchange.com/questions/229638/package-biblatex-warning-babel-polyglossia-detected-but-csquotes-missing
\usepackage{csquotes}

%to avoid many conflicts
%e.g., "Warning: Command \textcircled invalid in math mode"
%e.g., "Warning: Not defining \perthousand."
%e.g., "Warning: Font shape `OMS/cmsy/b/n' in size <3.75> not available(Font) size <5> substituted"
%https://tex.stackexchange.com/questions/139241/using-matbbz-and-textregistered-in-math-mode
\usepackage{textcomp}

%define command \blankpage
%https://tex.stackexchange.com/questions/36880/insert-a-blank-page-after-current-page
\def\blankpage{%
      \clearpage%
      \thispagestyle{empty}%
      \addtocounter{page}{-1}%
      \null%
      \clearpage}

%make package refcheck compatible with package hyperref 
\makeatletter
\AtBeginDocument{%
	\@ifpackageloaded{refcheck}{%
		\@ifundefined{hyperref}{}{%
			\let\T@ref@orig\T@ref
			\def\T@ref#1{\T@ref@orig{#1}\wrtusdrf{#1}}%
			\let\@refstar@orig\@refstar
			\def\@refstar#1{\@refstar@orig{#1}\wrtusdrf{#1}}%
			\DeclareRobustCommand\ref{\@ifstar\@refstar\T@ref}%
		}%
	}{}%
}
\makeatother